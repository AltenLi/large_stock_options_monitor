# 企微机器人配置说明

## 📋 申请企微机器人的前提条件

### 1. 企业微信账号要求
- ✅ 需要有**企业微信账号**（不是个人微信）
- ✅ 需要加入一个**企业微信群聊**
- ✅ 群聊中需要有**管理员权限**或群主同意

### 2. 如何获得企业微信
**方式一：加入现有企业**
- 让公司IT管理员邀请你加入企业微信
- 或者让同事邀请你加入公司群聊

**方式二：创建个人企业**
1. 访问企业微信官网：https://work.weixin.qq.com
2. 点击"免费注册"
3. 选择"创建企业"
4. 填写企业信息（可以填个人工作室）
5. 验证手机号和邮箱
6. 创建完成后，你就是企业管理员

**方式三：使用测试企业**
- 企业微信提供测试企业功能
- 可以创建测试群聊和机器人
- 适合个人开发测试使用

## 🤖 创建企微机器人详细步骤

### 方法一：群聊机器人（推荐）
1. **创建或加入企业微信群聊**
   - 在企业微信中创建一个群聊
   - 或加入现有的企业微信群聊

2. **添加群机器人**
   - 在群聊界面，点击右上角的"..."
   - 选择"群机器人"
   - 点击"添加机器人"
   - 输入机器人名称，如"港股期权监控"
   - 选择机器人头像（可选）
   - 点击"添加"

3. **获取Webhook地址**
   - 机器人创建成功后，会显示Webhook地址
   - 格式类似：`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxxxxx`
   - **重要**：复制并保存这个地址，配置时需要用到

4. **配置机器人权限**
   - 可以设置哪些成员可以使用机器人
   - 可以设置机器人的发送频率限制

### 方法二：企业应用机器人（高级）
1. **登录企业微信管理后台**
   - 访问：https://work.weixin.qq.com/wework_admin
   - 使用企业管理员账号登录

2. **创建企业应用**
   - 进入"应用管理"
   - 点击"创建应用"
   - 填写应用信息
   - 获取AgentId和Secret

3. **配置应用权限**
   - 设置可见范围
   - 配置API权限

## 📱 无企业微信的替代方案

### 1. 钉钉机器人
- 创建钉钉群聊
- 添加自定义机器人
- 获取Webhook地址
- 修改代码适配钉钉API

### 2. 飞书机器人
- 创建飞书群聊
- 添加自定义机器人
- 获取Webhook地址
- 修改代码适配飞书API

### 3. Slack机器人
- 创建Slack工作区
- 添加Incoming Webhooks
- 获取Webhook地址

### 4. 微信测试号
- 申请微信公众平台测试号
- 使用模板消息推送
- 需要关注测试号才能接收消息

## 🔧 快速申请企微机器人

### 方案一：创建免费企业微信（推荐）
1. **访问注册页面**
   ```
   https://work.weixin.qq.com/wework_admin/register_wx
   ```

2. **填写企业信息**
   ```
   企业名称: 个人工作室 / XX投资工作室
   行业: 信息技术 / 金融服务
   规模: 1-15人
   联系人: 你的姓名
   手机号: 你的手机号
   ```

3. **验证和激活**
   - 手机验证码验证
   - 邮箱验证（可选）
   - 下载企业微信APP
   - 登录管理员账号

4. **创建群聊和机器人**
   - 在企业微信中创建群聊
   - 按照上面的步骤添加机器人

### 方案二：加入现有企业
- 让同事邀请你加入公司企业微信
- 在公司群聊中添加机器人
- 需要群管理员权限

### 方案三：使用开发者测试
1. **申请企业微信开发者账号**
   ```
   https://developer.work.weixin.qq.com/
   ```

2. **创建测试企业**
   - 免费提供测试环境
   - 可以测试所有API功能
   - 适合开发和调试

## 🔧 无企业微信的替代方案

### 1. 钉钉机器人（推荐替代）
```bash
# 1. 下载钉钉APP
# 2. 创建群聊
# 3. 群设置 -> 智能群助手 -> 添加机器人 -> 自定义
# 4. 获取Webhook地址
```

### 2. 飞书机器人
```bash
# 1. 下载飞书APP
# 2. 创建群聊
# 3. 群设置 -> 机器人 -> 添加机器人 -> 自定义机器人
# 4. 获取Webhook地址
```

### 3. 邮件通知
```python
# 在config.py中配置
NOTIFICATION = {
    'enable_email': True,
    'email_config': {
        'smtp_server': 'smtp.gmail.com',  # Gmail
        'smtp_port': 587,
        'username': 'your_email@gmail.com',
        'password': 'your_app_password',  # 应用专用密码
        'to_emails': ['your_email@gmail.com'],
    }
}
```

### 4. Telegram机器人
```python
# 1. 在Telegram中搜索 @BotFather
# 2. 发送 /newbot 创建机器人
# 3. 获取Bot Token
# 4. 修改代码适配Telegram API
```

## 🧪 测试通知功能

运行测试脚本验证配置：

```bash
python test_notifications.py
```

该脚本会测试：
- ✅ 企微机器人连接
- ✅ 钉钉机器人连接  
- ✅ 邮件发送功能
- ✅ HTTP Webhook

## 📞 获取帮助

### 企业微信官方支持
- 客服电话: 400-902-3636
- 在线客服: https://work.weixin.qq.com/help
- 开发者文档: https://developer.work.weixin.qq.com/

### 常见问题
1. **Q: 个人可以申请企业微信吗？**
   A: 可以，填写个人工作室信息即可

2. **Q: 机器人有消息条数限制吗？**
   A: 有，每个机器人每分钟最多20条消息

3. **Q: Webhook地址会过期吗？**
   A: 不会，除非手动删除机器人

4. **Q: 可以在多个群里使用同一个机器人吗？**
   A: 不可以，每个群的机器人都有独立的Webhook

### 2. 配置系统
在 `config.py` 文件中配置企微机器人：

```python
# 通知设置
NOTIFICATION = {
    'enable_wework_bot': True,  # 启用企微机器人
    'wework_config': {
        'webhook_url': 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY_HERE',
        'mentioned_list': ['@all'],  # @所有人，或指定用户ID
        'mentioned_mobile_list': [],  # @指定手机号
    }
}
```

## 📱 消息类型

### 1. 期权大单提醒
当检测到符合条件的期权大单时，会发送详细信息：
- 股票名称和代码
- 期权类型（看涨/看跌）
- 交易方向（买入/卖出）
- 成交金额和数量
- 行权价和到期日
- 风险等级

### 2. 汇总报告
每小时发送一次汇总报告，包含：
- 总交易数和成交额
- 主要股票排行
- 最新大单信息

## 🔧 测试配置

运行测试脚本验证配置：

```bash
python -c "
from utils.wework_notifier import WeWorkNotifier
notifier = WeWorkNotifier('YOUR_WEBHOOK_URL')
success = notifier.test_connection()
print('企微机器人测试:', '成功' if success else '失败')
"
```

## 📋 消息示例

### 期权大单提醒
```
🚨 港股期权大单提醒

📊 股票: 腾讯控股 (HK.00700)
🎯 期权代码: HK.TCH241220C400
📈 期权类型: 看涨期权
🔄 交易方向: 买入 (买入开仓)
💰 成交金额: 187.5万港币
📦 成交量: 150手
💵 成交价: 12.500港币
🎯 行权价: 400.0港币
📅 到期日: 2024-12-20
⏰ 时间: 2025-09-01 20:15:30
⚠️ 风险等级: 中风险

💡 请关注后续走势变化！
```

### 汇总报告
```markdown
# 📊 港股期权大单日报

## 📈 今日概况
- **总交易数**: 5笔
- **总成交额**: 850.3万港币
- **更新时间**: 2025-09-01 20:00:00

## 🏆 主要股票
1. **腾讯控股** (HK.00700)
   - 成交额: 350.5万港币
   - 交易数: 2笔

2. **阿里巴巴-SW** (HK.09988)
   - 成交额: 280.8万港币
   - 交易数: 2笔

## 🔥 最新大单
**美团-W** (HK.03690)
- 期权: HK.MEI241220C200
- 类型: 看涨期权
- 方向: 买入
- 金额: 219.0万港币

> 数据来源: 港股期权监控系统
```

## ⚠️ 注意事项

1. **Webhook安全**: 不要将Webhook地址泄露给他人
2. **消息频率**: 系统会自动控制消息频率，避免刷屏
3. **@功能**: 谨慎使用@all功能，避免过度打扰
4. **测试环境**: 建议先在测试群中验证功能

## 🔄 启动监控

配置完成后，使用增强版监控脚本：

```bash

```

系统将自动：
- ✅ 监控期权大单
- ✅ 解析期权类型和方向
- ✅ 发送企微通知
- ✅ 生成汇总报告
- ✅ 记录历史数据